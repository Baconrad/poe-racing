<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>POE racing</title>
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/view-design/dist/styles/iview.css">
  <script type="text/javascript" src="https://vuejs.org/js/vue.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/view-design/dist/iview.min.js"></script>
</head>

<body>
  <div id="app">
    <div class="layout">
      <i-layout>
        <i-header>
          <i-menu mode="horizontal" theme="dark" active-name="1">
            <div class="layout-logo" style="color: #fff; text-align: center; font-size: 30px;">
              Path of Exile Racing
            </div>
          </i-menu>
        </i-header>
        <i-content>
          <div style="min-height: 200px;">
            <i-table :data="tableData1" :columns="tableColumns1" :loading="loading" no-data-text="no data" height="auto"
              stripe></i-table>
            <div style="margin: 10px;overflow: hidden">
              <div style="float: right;">
                <Page :total="100" :current="1" @on-change="changePage"></Page>
              </div>
            </div>
          </div>
        </i-content>
        <i-footer class="layout-footer-center">2020.05.10</i-footer>
      </i-layout>
    </div>
    <script>
      new Vue({
        el: '#app',
        data() {
          this.loadTableData(1);
          return {
            total: 0,
            loading: true,
            tableData1: [],
            tableColumns1: [{
                title: 'Online',
                key: 'online',
                render: (h, params) => {
                  const row = params.row;
                  const color = row.online ? 'success' : 'error';
                  return h('Tag', {
                    props: {
                      type: 'dot',
                      color: color
                    }
                  });
                }
              },
              {
                title: 'Rank',
                key: 'rank'
              },
              {
                title: 'Dead',
                key: 'dead',
                render: (h, params) => {
                  const row = params.row;
                  if (row.dead) {
                    return h('Tag', {
                      props: {
                        type: 'dot',
                        color: 'error'
                      }
                    }, 'Dead');
                  } else {
                    return h('div');
                  }
                }
              },
              {
                title: 'Account',
                key: 'account'
              },
              {
                title: 'Character',
                key: 'character'
              },
              {
                title: 'Class',
                key: 'class'
              },
              {
                title: 'Level',
                key: 'level'
              },
              {
                title: 'Experience',
                key: 'experience'
              }
            ]
          }
        },
        methods: {
          async loadTableData(current) {
            console.log('loadTableData')
            this.loading = true;
            const pageSize = 20;
            let offset = (current - 1) * pageSize;
            let limit = pageSize;
            let apiLink =
              `https://poe.game.qq.com/api/ladders?offset=${offset}&limit=${limit}&id=SCSPVP%E8%BF%B7%E9%9B%BE%E7%8B%BC%E4%BA%BA%E6%9C%8D%E9%82%80%E8%AF%B7%E8%B5%9B+(PL2584)&type=league&realm=pc`;
            let apiData = await fetch(apiLink)
              .then(function (response) {
                return response.json();
              })
            this.loading = false;
            let data = [];
            apiData.entries.forEach(entrie => {
              data.push({
                online: entrie.online,
                rank: entrie.rank,
                dead: entrie.dead,
                account: entrie.account.name,
                character: entrie.character.name,
                class: entrie.character.class,
                level: entrie.character.level,
                experience: entrie.character.experience,
              })
            });
            this.total = apiData.total / pageSize
            this.tableData1 = data
          },
          changePage(current) {
            this.loadTableData(current);
          }
        }
      })
    </script>
</body>

</html>
